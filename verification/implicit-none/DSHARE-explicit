!
!     INCLUDE DSHARE                           ( DATE: 26 Oct 2022 )
!
!
!     This version of 'DSHARE' has a number of changes from the version
!     of DSHARE uploaded to Github on 13 July 2021.
!
!      1) All variables in the common block have been explicitly declared.
!         This allows new routines (.f90 and later) to be written with
!         Fortran's 'implicit none' option turned on.  That is a lot
!         safer, as spelling a variable name wrong raises a compile error
!         rather than creating a new variable with random contents.
!
!      2) The CHARACTER*2 array variable TNUMV and the CHARACTER variables
!         have been moved to the end of the common block.  The double
!         precision real array XV has been moved to the start.
!         This rearrangement stops the compiler complaining about the
!         common block being misaligned and asking for the gfortran
!         compile switch '-fno-align-commons' to be used.
!
!      3) Added a reminder to increase LMTBL2 if the count of routes
!         is increased.
!
!      4) All the tab characters have been changed to spaces.
!
!      5) All comment characters in the first column have been changed
!         from C to ! so that DSHARE can be included in Fortran 95 files.
!
!
!
!****  ARRAY SIZE LIMITS       ****************************************
!
      integer, parameter :: LMBLP  = 20000 ! ARRAY BLP (APPROX=0.05*LMSECT**2)
      integer, parameter :: LMCLST = 75    ! NUMBER OF ENVIR. CONTROL ZONES
      integer, parameter :: LMCOND = 800   ! ARRAY COAEND
      integer, parameter :: LMCRPT = 12    ! MAXIMUM NUMBER OF CRITICAL POINTS
      integer, parameter :: LMEQRM = 1350  ! NUMBER OF EQUATIONS IN DTRM
      integer, parameter :: LMEXPD = 101   ! SPEED/TIME/HEAT RELEASE PROFILE PNTS
                                           ! ARRAYS TIMEV AND SPEEDV MUST BE
                                           ! DIMENSIONED THE MAXIMUM OF
                                           ! LMEXPD OR LMTSRT
      integer, parameter :: LMFNTP = 75    ! NUMBER OF FAN TYPES
      integer, parameter :: LMLPK  = 2220  ! ARRAY LPK (APPROX=3*LMNLOP)
      integer, parameter :: LMLPLK = 2700  ! ARRAY LOOP AND LKAN (APPROX=3*LMSECT)
      integer, parameter :: LMLSEG = 620   ! NUMBER OF LINE SEGMENTS
      integer, parameter :: LMLSS  = 1200  ! NUMBER OF LINE SUBSEGMENTS.
      integer, parameter :: LMNLOP = 500   ! NUMBER OF FLOW LOOPS (< LMSECT-1)
      integer, parameter :: LMNODE = 600   ! NUMBER OF AERODYNAMIC NODES
      integer, parameter :: LMNODX = 999   ! NODE EXTERNAL ID NUMBER
      integer, parameter :: LMPRGP = 25    ! NUMBER OF PRINT GROUPS
      integer, parameter :: LMSCND = 5     ! NUMBER OF SECTIONS ATTACHED TO A
                                           ! A NODE.  AN INCREASE IN THIS
                                           ! NUMBER REQUIRES MODIFICATIONS
                                           ! TO SUBROUTINE THNODE
      integer, parameter :: LMSCTX = 999   ! SECTION EXTERNAL ID NUMBER
      integer, parameter :: LMSECT = 900   ! NUMBER OF SECTIONS.
      integer, parameter :: LMSS   = 1600  ! NUMBER OF SUBSEGMENTS
      integer, parameter :: LMSSTN = 2200  ! NUMBER OF SUBSEGMENTS PLUS
                                           ! THERMODYNAMIC NODES
      integer, parameter :: LMSTR  = 50    ! ENERGY SECTOR ARRAYS
      integer, parameter :: LMTBL2 = 20000 ! TABLE 2
      integer, parameter :: LMTHND = 600   ! NUMBER OF THERMODYNAMIC NODES
      integer, parameter :: LMTRAN = 75    ! NUMBER OF OPERATIONAL TRAINS
      integer, parameter :: LMTRGP = 25    ! NUMBER OF TRAIN DISPATCHER GROUPS
      integer, parameter :: LMTRRT = 20    ! NUMBER OF TRAIN ROUTES
                                           ! NOTE THAT DURING A DETAILED PRINT
                                           ! ONLY THE TRAINS ALONG THE FIRST
                                           ! FOURTEEN (14) ROUTES ARE SHOWN DUE
                                           ! TO THE 132 COLUMN LIMIT
                                           ! SEE FORMAT STATEMENTS 710 THROUGH 733
                                           ! IN SUBROUTINE PRINT.  If you increase
                                           ! this, you may also need to increase
                                           ! LMTBL2.  There is guidance in the
                                           ! description of LMTBL2 in Record.txt.
      integer, parameter :: LMTRSG = 8     ! NUMBER OF TRAINS SIMULTANEOUSLY
                                           ! LOCATED IN A SEGMENT
      integer, parameter :: LMTRTP = 16    ! NUMBER OF TRAIN TYPES
      integer, parameter :: LMTSRT = 620   ! NUMBER OF TRACK SECTIONS IN A ROUTE
                                           ! ARRAYS TIMEV AND SPEEDV MUST BE
                                           ! DIMENSIONED THE MAXIMUM OF
                                           ! LMEXPD OR LMTSRT
      integer, parameter :: LMUL   = 50    ! NUMBER OF UNSTEADY HEAT SOURCES
      integer, parameter :: LMVSEG = 406   ! NUMBER OF VENTILATION SHAFTS
      integer, parameter :: LMEXTRA= 350   ! SPECIAL ARRAYS EXTRA AND IEXTRA
                                           ! THESE ARRAYS ARE FOR SPECIAL
                                           ! VERSIONS OF SES - NOT USED BY
                                           ! BASIC SES.
! *************** END OF ARRAY SIZE LIMIT DEFINITIONS ****************
!
!
! ******************** New variables for OpenSES *********************
!
!
! ************************ INTEGER VARIABLES *************************
!
!  GENERAL VARIABLES
      INTEGER   AETIME, BLPREQ, DEATH, DESPER, EXITCODE, FIROPT, FIROP2
      INTEGER   FSCFT, HCOPT, HSOPT, HUMOPT, OUT, PRTIME
      INTEGER   RST, RSTROPT, RSTWOPT, SUPOPT, THOPT, THTIME, TNLSS
      INTEGER   TNSS, TPOPT, TRTIME, SCREEN
!  SECTION VARIABLES  (LMSECT)
      INTEGER   NTQPS(LMSECT), TABL9(LMSECT), TABL10(LMSECT)
      INTEGER   TABL11(LMSECT), TABL12(LMSECT), TABL13(LMSECT)
      INTEGER   TABL20(LMSECT), TABL21(LMSECT)
!    SECTION (LMSECT), SECTION+ONE  (LMSECT+1), SECTION+TWO (LMSECT+2)
      INTEGER   ND(LMSECT), NDS(LMSECT+1), NDSS(LMSECT+2)
!    SECTION * ESTIMATED AVERAGE OF 3 LOOPS THROUGH SECTION ( LMLPLK )
      INTEGER   LKAN(LMLPLK)
!    SECTION EXTERNAL IDENTIFICATION NUMBERS (LMSCTX)
      INTEGER   TABL14(LMSCTX)
!  NODE VARIABLES  (LMNODE)
      INTEGER   TABL15(LMNODE), TABL16(LMNODE), TABL22(LMNODE)
      INTEGER   TABL45(LMNODE), TYPTND(LMNODE)
!  NODE VARIABLES  (LMNODE+1)
      INTEGER   TABL1(LMNODE+1), TABL23(LMNODE+1)
!  AERODYNAMIC NODE VARIABLES (LMTBL2)
      INTEGER   TABL2(LMTBL2)
!    NODES BY NUMBER OF SECTIONS CONNECTED TO NODE (LMNODE X LMSCND)
      INTEGER   TABL17(LMNODE,LMSCND), TABL18(LMNODE,LMSCND)
!    NODE EXTERNAL IDENTIFICATION NUMBERS (LMNODX)
      INTEGER   TABL19(LMNODX)
!  LINE SEGMENT VARIABLES  (LMLSEG)
      INTEGER   NTRNLS(LMLSEG), NUMLS(LMLSEG), TABL3(LMLSEG)
      INTEGER   TABL4(LMLSEG), TABL8(LMLSEG), TYPLS(LMLSEG)
!    LINE SEGMENT BY NUMBER OF TRAINS IN SEGMENT  (LMLSEG X LMTRSG)
      INTEGER   TRNNLS(LMLSEG,LMTRSG)
!  VENTILATION SHAFT SEGMENT VARIABLES    ( LMVSEG )
      INTEGER   FTOFVS(LMVSEG), FTONVS(LMVSEG)
      INTEGER   EXVOVS(LMVSEG), FTYPVS(LMVSEG), NUMVS(LMVSEG)
      INTEGER   TABL5(LMVSEG), TABL6(LMVSEG), TYPVS(LMVSEG)
!  SUBSEGMENT VARIABLES  (LMSS)
      INTEGER   TABL7(LMSS), TABL44(LMSS)
!  LINE SUBSEGMENT VARIABLES   ( LMLSS X TABLE SIZE )
      INTEGER   EXDTDB(LMLSS,6)
!  HEATING OR COOLING ZONE CLUSTER VARIABLES  (LMCLST)
      INTEGER   TYPCL(LMCLST)
!  SUBWAY VEHICLE TYPE VARIABLES  (LMTRTP)
      INTEGER   NCARV(LMTRTP), NPCARV(LMTRTP)
!  UNDERPLATFORM EXHAUST VARIABLES
      INTEGER   OPTUX
!  ROUTE VARIABLES  (LMTRRT)
      INTEGER   COPTRT(LMTRRT), NTSRT(LMTRRT)
!    DISPATCHER VARIABLES (LMTRRT) AND (LMTRGP X LMTRRT)
      INTEGER   GRTYPV(LMTRGP,LMTRRT), JGROUP(LMTRRT), NGRV(LMTRRT)
      INTEGER   NMTRGR(LMTRRT), NTRGR(LMTRGP,LMTRRT)
      INTEGER   GRHDWY(LMTRGP,LMTRRT)
!    TRACK SECTION VARIABLES  (LMTSRT X LMTRRT)
      INTEGER   DWLTS(LMTSRT,LMTRRT)
      INTEGER   NPETTS(LMTSRT,LMTRRT), NSEGTS(LMTSRT,LMTRRT)
!    EXPLICIT TRAIN PERFORMANCE  ( MAX(LMTSRT, LMEXPD) X LMTRRT)
      INTEGER   NEXPDP(LMTRRT), TIMEV(LMTSRT,LMTRRT)
!  OPERATIONAL TRAIN VARIABLES  (LMTRAN)
      INTEGER   DPV(LMTRAN), IINDEX(LMTRAN), IROTEV(LMTRAN)
      INTEGER   ITYPV(LMTRAN), MODEV(LMTRAN), NTSV(LMTRAN)
      INTEGER   NTSV2(LMTRAN), TLPSV(LMTRAN)
      INTEGER   TSTRTV(LMTRAN)
!  IMPULSE FAN VARIABLES
      INTEGER   TOFIFS(6), TONIFS(6)
!  UNSTEADY HEAT LOAD VARIABLES  ( LMUL )
      INTEGER   LSSUL(LMUL)
!  PRINT GROUP VARIABLES  ( LMPRGP )
      INTEGER   GINTPR(LMPRGP), GRABBP(LMPRGP), GRATAE(LMPRGP)
      INTEGER   GRATTH(LMPRGP), GRSUM(LMPRGP), NPRGR(LMPRGP)
!
! ************************** REAL VARIABLES **************************
!  DOUBLE PRECISION VARIABLES
      DOUBLE PRECISION XV(LMTRAN)
!  GENERAL VARIABLES
      REAL     NUAIR, MPHFPS
!  LINE SEGMENT VARIABLES (LMLSEG)
      REAL     LLS(LMLSEG), LLSS(LMLSEG)
!  VENTILATION SHAFT SEGMENT VARIABLES (LMVSEG)
      REAL     LVS(LMVSEG), LVSS(LMVSEG)
!  SUBSEGMENT VARIABLES (LMSS)
      REAL     LHLTSS(LMSS), LSUMSS(LMSS)
!  LINE SUBSEGMENT VARIABLES (LMLSS)
      REAL     LACLSS(LMLSS), LHLSS(LMLSS)
!  ZONE VARIABLES
!  SUBWAY VEHICLE TYPE VARIABLES (LMTRTP)
      REAL     LAMDAV(LMTRTP), LHREV(LMTRTP), LHRPV(LMTRTP)
      REAL     LV(LMTRTP), MCPGAV(LMTRTP)
      REAL     MCPGDV(LMTRTP), MOTORV(LMTRTP)
!  OPERATIONAL TRAIN VARIABLES
      REAL     ILINE, IMOTOR
!
! ************************ CHARACTER VARIABLES ***********************
!  OPERATIONAL TRAIN VARIABLES  (LMTRAN)
      CHARACTER*2 TNUMV(LMTRAN)
!  LINE SUBSEGMENT BY TRAIN ROUTE ( LMLSS X LMTRRT )
      CHARACTER*2   ITNLSS(LMLSS,LMTRRT)
!  LINE SEGMENT VARIABLES  ( LMLSEG )
      CHARACTER*36  NAMLS(LMLSEG)
!  VENTILATION SHAFT SEGMENT VARIABLES  ( LMVSEG )
      CHARACTER*36 NAMVS(LMVSEG)
!  FILE INPUT/OUTPUT VARIABLES
      CHARACTER  DATETIME*20, SESVER*8, TITLE*80
      CHARACTER*9   MONTHS (12)
      CHARACTER HEADER*116, FOOTER*122
      CHARACTER*254 FILENAME,INPFILE, RESTART, PRNTCTRL
!
! ******************** Formerly undeclared variables *******************
!
      real    annamp, delae
      real    delp, delt, delth, deltr, del2th
      real    eecpg, efamux, efasux, esptsr
      real    hmambe, hmambm, hour
      real    humamb
      integer idot, iequat
      integer in, inode, iprgrp, isitu, izap, jratae, jratth, jrattr
      integer kaero, kastep, kbnd1, kbnd2, kbnd3, kprnth, ktstep
      integer ktwall, life
      integer lines, maxtim, month, mxmnpt, nbr, nbrjct, ndelt
      integer ndtypa, new, newpage, nfntyp, niftyp, nloop, nls, nlscp1
      integer nlsec, nnode, nosumy, nosys, notran
      integer npgrp, nportl, nsec, nsimer, nstr
      integer ntime, ntnode, ntran, ntrrte, ntrtyp, ntwall,numul,nvsec
      integer nzone
      real    pamb, pinpt
      real    sumtst, tamba, tambm, tdbamb
      real    tiempo
      real    twbamb, twambe, twambm, wntsum, zap
!  Physical constants
      real    abtemp, btuflb, cp, flbbtu, flbhp, fpsmph, ftin, gracc
      real    hvh2o, pi, pr, rdryar, rhocp, rhomas
      real    rhowht, sainhg, sapsi, stefan, thcon, tonlb, visair
      real    wgcons, wtbtus, absamb
!  Section variables  ( LMSECT )
      real    ahighs(lmsect), alows(lmsect), bcs(lmsect), bs(lmsect)
      real    buoys(lmsect), ceps(lmsect), cens(lmsect)
      real    dqdts(lmsect)
      integer mnqs(lmsect), mxqs(lmsect)
      real    omegs(lmsect), qs(lmsect), qsaves(lmsect)
      real    qsmx(lmsect), qsmn(lmsect), sumqns(lmsect)
      real    sumqps(lmsect)
      real    vhighs(lmsect), vlows(lmsect)
!  Aerodynamic junction coefficients ( LMCOND )
      real    coaend(lmcond)
!  Thermodynamic node variables  ( LMTHND )
      real    havgtn(lmthnd), humtn(lmthnd), tavgtn(lmthnd)
      real    tdbtn(lmthnd)
!    thermodynamic nodes by number of sections connected to a node
!    ( lmthnd x lmscnd )
      real    emhbtn(lmthnd,lmscnd), emtbtn(lmthnd,lmscnd)
      real    flobtn(lmthnd,lmscnd)
!  Loop variables  ( LMNLOP )
      real    dqdtlp(lmnlop), omeglp(lmnlop), qerrlp(lmnlop)
      real    qlp(lmnlop)
!  Aerodynamic matrix of coefficients - array size estimated at
!  approximently 0.05*lmsect**2  (LMBLP)
      real    blp(lmblp)
!  Line segment variables  ( LMLSEG )
      real    als(lmlseg),c1ls(lmlseg),cbnls(lmlseg),cbpls(lmlseg)
      real    cfnls(lmlseg), cfpls(lmlseg),dbtls(lmlseg)
      real    dtdels(lmlseg), dtdmls(lmlseg),dthels(lmlseg)
      real    dthmls(lmlseg), dtwels(lmlseg),dtwmls(lmlseg)
      real    epsls(lmlseg), fffls(lmlseg), fls(lmlseg)
      real    pdryls(lmlseg)
      real    permls(lmlseg), rels(lmlseg),rnfls(lmlseg)
      real    rprmls(lmlseg), saxlls(lmlseg), saxsls(lmlseg)
      real    sprols(lmlseg), stakls(lmlseg), sullls(lmlseg)
      real    sulsls(lmlseg), surlss(lmlseg), sqwlls(lmlseg)
      real    sqrdls(lmlseg), thcnls(2,lmlseg)
      real    thdfls(2,lmlseg), tsnkls(lmlseg), vollss(lmlseg)
!  Line segment by twice the number of trains in a line segment
!  (LMLSEG x 2*LMTRSG)
      real    trndls(lmlseg,2*lmtrsg)
!  Ventilation shaft segment variables  ( LMVSEG )
      real    agvs(lmvseg), avs(lmvseg), fdirvs(lmvseg)
      real    fpmxvs(lmvseg),fpmnvs(lmvseg)
      integer mnfpvs(lmvseg)
      integer mxfpvs(lmvseg)
      real    revs(lmvseg), rnfvs(lmvseg)
      real    stakvs(lmvseg), survss(lmvseg)
      real    volvss(lmvseg), vomxvs(lmvseg)
!  Subsegment variables (line and vent shaft subsegment)  (LMSS)
      real    derhss(lmss), dertss(lmss), emtbss(lmss), emtfss(lmss)
      real    emhbss(lmss), emhfss(lmss), fbss(lmss), ffss(lmss)
      real    flobss(lmss), flofss(lmss), hrmn(lmss), hrmx(lmss)
      real    hsumss(lmss), htrnss(lmss), htmpss(lmss), htsmss(lmss)
      real    humss(lmss)
      integer mnhr(lmss), mntdb(lmss)
      integer mntwb(lmss), mxhr(lmss), mxtdb(lmss), mxtwb(lmss)
      real    qerhss(lmss), qertss(lmss)
      real    qradss(lmss), qsmxss(lmss), qsumss(lmss)
      real    shltss(lmss), shrss(lmss), shuxss(lmss), stdbss(lmss)
      real    stdnss(lmss), stdpss(lmss), stwbss(lmss)
      real    tdbss(lmss), tdbmn(lmss), tdbmx(lmss),tsfss(lmss)
      real    tsstab(lmss), ttmpss(lmss)
      real    twbss(lmss), twbmn(lmss), twbmx(lmss), volss(lmss)
!  Line subsegment variables  (LMLSS)
      real    qwalss(lmlss), relss(lmlss)
      real    saclss(lmlss), shlss(lmlss)
!  Train type variables  ( LMTRTP )
      real    acaccv(lmtrtp), accv(lmtrtp), acdecv(lmtrtp)
      real    alossv(lmtrtp), araccv(lmtrtp), ardecv(lmtrtp)
      real    av(lmtrtp), blossv(lmtrtp), cdbvov(lmtrtp)
      real    cdfvov(lmtrtp), chpr1v(lmtrtp), chpr2v(lmtrtp)
      real    clossv(lmtrtp), coamp(lmtrtp,4),coampl(lmtrtp,6)
      real    coatev(lmtrtp),cobtev(lmtrtp),cormv(lmtrtp,3)
      real    cotev(lmtrtp,4), decav(lmtrtp), decbv(lmtrtp)
      real    decv(lmtrtp), decv1v(lmtrtp), diacgv(lmtrtp)
      real    didcgv(lmtrtp), dlossv(lmtrtp), elossv(lmtrtp)
      real    emisag(lmtrtp), emisdg(lmtrtp), eta1v(lmtrtp)
      real    eta2v(lmtrtp), flyjv(lmtrtp), flyopv(lmtrtp)
      integer noptv(lmtrtp)
      real    pauxev(lmtrtp)
      real    pauxpv(lmtrtp), permv(lmtrtp), regenv(lmtrtp)
      real    re1m(lmtrtp), re2m(lmtrtp), re3m(lmtrtp)
      real    rpsmnv(lmtrtp), rpsmxv(lmtrtp), rpsov(lmtrtp)
      real    rracc(lmtrtp), shrev(lmtrtp), shrpv(lmtrtp)
      real    slopev(lmtrtp), spinv(lmtrtp), sp1(lmtrtp)
      real    sp2(lmtrtp), sre1m(lmtrtp), sre2m(lmtrtp)
      real    tesp1(lmtrtp), tiaccv(lmtrtp), tidecv(lmtrtp)
      real    uchprv(lmtrtp), u2m(lmtrtp), u3m(lmtrtp)
      real    vgridv(lmtrtp), voltmv(lmtrtp), voltsv(lmtrtp)
      real    weelsv(lmtrtp), wv(lmtrtp)
!   Underplatform exhaust variables
      real    efsux, efmux, umaxux
!   Route variables  ( LMTRRT )
      real   origrt(lmtrrt), uminrt(lmtrrt)
!   Dispatcher variables  ( LMTRRT ) and ( LMTRGP x LMTRRT )
      integer ntimtr(lmtrrt)
      integer numbtr
!   Track section variables  ( LMTSRT x LMTRRT )
      real   fsts(lmtsrt,lmtrrt), grdts(lmtsrt,lmtrrt)
      real   radts(lmtsrt,lmtrrt)
      real   umxts(lmtsrt,lmtrrt)
!   Explicit train performance variables  ( LMEXPD x LMTRRT )
!   The first subscript of speedv and timev has to be dimensioned the
!   maximum of lmtsrt or lmexpd because of temp use in sub trins
      real    qgridv(lmexpd,lmtrrt)
      real    speedv(lmtsrt,lmtrrt)
!   Operational train variables  ( LMTRAN )
      real    ampv(lmtran), amplv(lmtran), anvv(lmtran)
      real    dgrdqv(lmtran), dragv(lmtran)
      real    dudtv(lmtran), fkenew(lmtran)
      real    pauxv(lmtran), pflyv(lmtran)
      real    pow1(lmtran), ppropv(lmtran), pregnv(lmtran)
      real    qaccv(lmtran), qaxlv(lmtran), qaxsv(lmtran)
      real    qdecv(lmtran), qeracv(lmtran), qerdcv(lmtran)
      real    qprpv(lmtran), rgsumv(lmtran), rmhtv(lmtran)
      real    rps(lmtran), rsistv(lmtran), taavgv(lmtran)
      real    tev(lmtran), tgaccv(lmtran), tgdecv(lmtran)
      real    twavgv(lmtran), uv(lmtran)
      real    wpatv(lmtran), xlastv(lmtran)
!  Power sector variables (LMSTR)
      real    eauxsr(lmstr), eprfsr(lmstr), epr3sr(lmstr)
      real    ergnsr(lmstr)
!  Fan type variables  ( LMFNTP )
      real    cfmhft(lmfntp), cfmlft(lmfntp), fn1ift(lmfntp)
      real    fn2ift(lmfntp), fn3ift(lmfntp), fn4ift(lmfntp)
      real    fn1oft(lmfntp), fn2oft(lmfntp), fn3oft(lmfntp)
      real    fn4oft(lmfntp), timft(lmfntp)
!  Impulse fan variables
      real    qifs(6), vifs(6)
!  Unsteady heat load variables  ( LMUL )
      real    afirul(lmul), hllul(lmul), hlsul(lmul)
      integer ltonul(lmul), ltoful(lmul)
      real    tflmul(lmul), throtl(lmul)
!  Patron characteristics
      real    patwht
!  Work arrays used for special versions of ses - not used by basic ses
      real    extra(lmextra)
      integer iextra(lmextra)
!
! ****************************** COMMON ******************************
!
! Double precision variable, having it here avoids the need for byte padding.
      COMMON   XV

! GENERAL VARIABLES
      COMMON   AETIME, ANNAMP, BLPREQ, DEATH, DELAE
      COMMON   DELP, DELT, DELTH, DELTR, DEL2TH, DESPER, EXITCODE
      COMMON   EECPG, EFAMUX, EFASUX, ESPTSR, FIROPT, FIROP2, FSCFT
      COMMON   HCOPT, HMAMBE, HMAMBM, HOUR, HSOPT
      COMMON   HUMAMB, HUMOPT, IDOT, IEQUAT, ILINE, IMOTOR
      COMMON   IN, INODE, IPRGRP, ISITU, IZAP, JRATAE, JRATTH, JRATTR
      COMMON   KAERO, KASTEP, KBND1, KBND2, KBND3, KPRNTH, KTSTEP
      COMMON   KTWALL, LIFE
      COMMON   LINES, MAXTIM, MONTH, MXMNPT, NBR, NBRJCT, NDELT
      COMMON   NDTYPA, NEW, NEWPAGE, NFNTYP, NIFTYP, NLOOP, NLS, NLSCP1
      COMMON   NLSEC, NNODE, NOSUMY, NOSYS, NOTRAN
      COMMON   NPGRP, NPORTL, NSEC, NSIMER, NSTR
      COMMON   NTIME, NTNODE, NTRAN, NTRRTE, NTRTYP, NTWALL,NUMUL,NVSEC
      COMMON   NZONE, OUT, PAMB, PINPT, PRTIME, RST, RSTROPT, RSTWOPT
      COMMON   SUMTST, SUPOPT, TAMBA, TAMBM, TDBAMB
      COMMON   THOPT, THTIME, TIEMPO, TNLSS, TNSS, TPOPT, TRTIME, SCREEN
      COMMON   TWBAMB, TWAMBE, TWAMBM, WNTSUM, ZAP
!  PHYSICAL CONSTANTS
      COMMON   ABTEMP, BTUFLB, CP, FLBBTU, FLBHP, FPSMPH, FTIN, GRACC
      COMMON   HVH2O, MPHFPS, NUAIR, PI, PR, RDRYAR, RHOCP, RHOMAS
      COMMON   RHOWHT, SAINHG, SAPSI, STEFAN, THCON, TONLB, VISAIR
      COMMON   WGCONS, WTBTUS, ABSAMB
!  SECTION VARIABLES  ( LMSECT )
      COMMON   AHIGHS, ALOWS, BCS, BS
      COMMON   BUOYS, CEPS, CENS
      COMMON   DQDTS, MNQS, MXQS, NTQPS
      COMMON   OMEGS, QS, QSAVES
      COMMON   QSMX, QSMN, SUMQNS
      COMMON   SUMQPS, TABL9, TABL10, TABL11, TABL12
      COMMON   TABL13, TABL20, TABL21, VHIGHS, VLOWS
!    SECTION + TWO  (LMSECT+2)
      COMMON   NDSS
!    SECTION * ESTIMATED AVERAGE OF 2.5 LOOPS THROUGH SECTION ( LMLPLK )
      COMMON   LKAN
!    SECTION EXTERNAL IDENTIFICATION NUMBERS
      COMMON   TABL14
!  NODE VARIABLES  ( LMNODE )
      COMMON   TABL1, TABL15, TABL16, TABL17, TABL18, TABL22, TABL23
      COMMON   TABL45, TYPTND
!    NODE EXTERNAL IDENTIFICATION NUMBERS
      COMMON   TABL19
!  AERODYNAMIC NODE VARIABLES  (LMTBL2)
      COMMON   TABL2
!  AERODYNAMIC JUNCTION COEFFICIENTS ( LMCOND )
      COMMON   COAEND
!  THERMODYNAMIC NODE VARIABLES  ( LMTHND )
      COMMON   HAVGTN, HUMTN, TAVGTN
      COMMON   TDBTN
!    THERMODYNAMIC NODES BY NUMBER OF SECTIONS CONNECTED TO A NODE
!    ( LMTHND X LMSCND )
      COMMON   EMHBTN, EMTBTN
      COMMON   FLOBTN
!  LOOP VARIABLES  ( LMNLOP )
      COMMON   DQDTLP, OMEGLP, QERRLP
      COMMON   QLP
!  AERODYNAMIC MATRIX OF COEFFICIENTS - ARRAY SIZE ESTIMATED AT
!  APPROXIMENTLY 0.05*LMSECT**2  (LMBLP)
      COMMON   BLP
!  LINE SEGMENT VARIABLES  ( LMLSEG )
      COMMON   ALS, C1LS, CBNLS, CBPLS
      COMMON   CFNLS, CFPLS, DBTLS
      COMMON   DTDELS, DTDMLS, DTHELS
      COMMON   DTHMLS, DTWELS, DTWMLS
      COMMON   EPSLS, FFFLS, FLS, LLS, LLSS
      COMMON   NAMLS, NTRNLS, NUMLS, PDRYLS
      COMMON   PERMLS, RELS, RNFLS
      COMMON   RPRMLS, SAXLLS, SAXSLS
      COMMON   SPROLS, STAKLS, SULLLS
      COMMON   SULSLS, SURLSS, SQWLLS
      COMMON   SQRDLS, TABL3, TABL4, TABL8, THCNLS
      COMMON   THDFLS, TSNKLS, TYPLS, VOLLSS
!    LINE SEGMENT BY NUMBER OF TRAINS IN LINE SEGMENT (LMLSEG X LMTRSG)
      COMMON   TRNNLS
!    LINE SEGMENT BY TWICE THE NUMBER OF TRAINS IN A LINE SEGMENT
!    (LMLSEG X 2*LMTRSG)
      COMMON   TRNDLS
!  VENTILATION SHAFT SEGMENT VARIABLES  ( LMVSEG )
      COMMON   AGVS, AVS, EXVOVS, FDIRVS
      COMMON   FPMXVS, FPMNVS, FTOFVS, FTONVS, FTYPVS
      COMMON   LVS, LVSS, NAMVS, MNFPVS
      COMMON   MXFPVS, NUMVS, REVS, RNFVS
      COMMON   STAKVS, SURVSS, TABL5, TABL6, TYPVS
      COMMON   VOLVSS, VOMXVS
!  SUBSEGMENT VARIABLES (LINE AND VENT SHAFT SUBSEGMENT)  (LMSS)
      COMMON   DERHSS, DERTSS, EMTBSS, EMTFSS
      COMMON   EMHBSS, EMHFSS, FBSS, FFSS
      COMMON   FLOBSS, FLOFSS, HRMN, HRMX
      COMMON   HSUMSS, HTRNSS, HTMPSS, HTSMSS
      COMMON   HUMSS, LHLTSS, LSUMSS, MNHR, MNTDB
      COMMON   MNTWB, MXHR, MXTDB, MXTWB
      COMMON   QERHSS, QERTSS
      COMMON   QRADSS, QSMXSS, QSUMSS
      COMMON   SHLTSS, SHRSS, SHUXSS, STDBSS
      COMMON   STDNSS, STDPSS, STWBSS, TABL7, TABL44
      COMMON   TDBSS, TDBMN, TDBMX,TSFSS
      COMMON   TSSTAB, TTMPSS
      COMMON   TWBSS, TWBMN, TWBMX, VOLSS
!  LINE SUBSEGMENT VARIABLES  (LMLSS)
      COMMON   EXDTDB, LACLSS, LHLSS, QWALSS, RELSS
      COMMON   SACLSS, SHLSS
!    LINE SUBSEGMENT BY TRAIN ROUTE  (LMLSS X LMTRRT)
      COMMON   ITNLSS
!  ZONE CLUSTER VARIABLES
      COMMON   TYPCL
!  TRAIN TYPE VARIABLES  ( LMTRTP )
      COMMON  ACACCV, ACCV, ACDECV
      COMMON  ALOSSV, ARACCV, ARDECV
      COMMON  AV, BLOSSV, CDBVOV
      COMMON  CDFVOV, CHPR1V, CHPR2V
      COMMON  CLOSSV, COAMP,COAMPL
      COMMON  COATEV,COBTEV,CORMV
      COMMON  COTEV, DECAV, DECBV
      COMMON  DECV, DECV1V, DIACGV
      COMMON  DIDCGV, DLOSSV, ELOSSV
      COMMON  EMISAG, EMISDG, ETA1V
      COMMON  ETA2V, FLYJV, FLYOPV
      COMMON  LAMDAV, LHREV, LHRPV, LV, MCPGAV, MCPGDV, MOTORV
      COMMON  NCARV, NOPTV, NPCARV, PAUXEV
      COMMON  PAUXPV, PERMV, REGENV
      COMMON  RE1M, RE2M, RE3M
      COMMON  RPSMNV, RPSMXV, RPSOV
      COMMON  RRACC, SHREV, SHRPV
      COMMON  SLOPEV, SPINV, SP1
      COMMON  SP2, SRE1M, SRE2M
      COMMON  TESP1, TIACCV, TIDECV
      COMMON  UCHPRV, U2M, U3M
      COMMON  VGRIDV, VOLTMV, VOLTSV
      COMMON  WEELSV, WV
!   UNDERPLATFORM EXHAUST VARIABLES
      COMMON   EFSUX, EFMUX, OPTUX, UMAXUX
!  ROUTE VARIABLES  ( LMTRRT )
      COMMON   COPTRT, NTSRT, ORIGRT, UMINRT
!    DISPATCHER VARIABLES  ( LMTRRT ) AND ( LMTRGP X LMTRRT )
      COMMON   GRHDWY, GRTYPV, JGROUP, NGRV, NMTRGR, NTIMTR
      COMMON   NTRGR, NUMBTR
!    TRACK SECTION VARIABLES  ( LMTSRT X LMTRRT )
      COMMON   DWLTS, FSTS, GRDTS
      COMMON   NPETTS, NSEGTS, RADTS
      COMMON   UMXTS
!    EXPLICIT TRAIN PERFORMANCE VARIABLES  ( LMEXPD X LMTRRT )
!    THE FIRST SUBSCRIPT OF SPEEDV AND TIMEV HAS TO BE DIMENSIONED THE
!    MAXIMUM OF LMTSRT OR LMEXPD BECAUSE OF TEMP USE IN SUB TRINS
      COMMON   NEXPDP, QGRIDV
      COMMON   SPEEDV, TIMEV
!  OPERATIONAL TRAIN VARIABLES  ( LMTRAN )
      COMMON   AMPV, AMPLV, ANVV
      COMMON   DGRDQV, DPV, DRAGV
      COMMON   DUDTV, FKENEW, IINDEX, IROTEV, ITYPV
      COMMON   MODEV, NTSV, NTSV2, PAUXV, PFLYV
      COMMON   POW1, PPROPV, PREGNV
      COMMON   QACCV, QAXLV, QAXSV
      COMMON   QDECV, QERACV, QERDCV
      COMMON   QPRPV, RGSUMV, RMHTV
      COMMON   RPS, RSISTV, TAAVGV
      COMMON   TEV, TGACCV, TGDECV, TLPSV
      COMMON   TSTRTV, TWAVGV, UV
      COMMON   WPATV, XLASTV
!  POWER SECTOR VARIABLES (LMSTR)
      COMMON   EAUXSR, EPRFSR, EPR3SR
      COMMON   ERGNSR
!  FAN TYPE VARIABLES  ( LMFNTP )
      COMMON  CFMHFT, CFMLFT, FN1IFT
      COMMON  FN2IFT, FN3IFT, FN4IFT
      COMMON  FN1OFT, FN2OFT, FN3OFT
      COMMON  FN4OFT, TIMFT
!  IMPULSE FAN VARIABLES
      COMMON   QIFS, TOFIFS, TONIFS, VIFS
!  UNSTEADY HEAT LOAD VARIABLES  ( LMUL )
      COMMON   AFIRUL, HLLUL, HLSUL, LSSUL
      COMMON   LTONUL, LTOFUL, TFLMUL, THROTL
!  PATRON CHARACTERISTICS
      COMMON   PATWHT
!  WORK ARRAYS USED FOR SPECIAL VERSIONS OF SES - NOT USED BY BASIC SES
      COMMON   EXTRA, IEXTRA
!  PRINT GROUP VARIABLES  ( LMPRGP )
      COMMON   GINTPR, GRABBP, GRATAE, GRATTH, GRSUM, NPRGR


! When adding new variables to the common block, place them above this
! comment.  We want to keep the variables below (some of which have
! odd lengths) at the end of the common block so that gfortran does not
! raise warnings about non-aligned common blocks.
!  FILE INPUT/OUTPUT VARIABLES
      COMMON   FILENAME, INPFILE, RESTART, PRNTCTRL, HEADER, FOOTER
      COMMON   DATETIME, TITLE, MONTHS, SESVER
      COMMON   TNUMV

      EQUIVALENCE  (ND(1), NDS(2), NDSS(3))
!
!
!*****DSHARE  END******************************************************
!
